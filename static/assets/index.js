var $=Object.defineProperty;var E=(o,t,n)=>t in o?$(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var d=(o,t,n)=>E(o,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();function h(o){const t=document.getElementById("log");t.textContent=`${o} 
${t.textContent}`}function L(o){let t=o.identifier%16,n=Math.floor(o.identifier+5)%16,i=Math.floor(o.identifier+10)%16;return`#${t.toString(16)}${t.toString(16)}${n.toString(16)}${n.toString(16)}${i.toString(16)}${i.toString(16)}`}function p(o,t,n,i,e,s,r,v){const u=o.createLinearGradient(t,n,i,e);if(s.length!=7)return s;const w=s+Math.floor(r*255).toString(16).padStart(2,"0");u.addColorStop(0,w);const S=s+Math.floor(v*255).toString(16).padStart(2,"0");return u.addColorStop(1,S),u}const g=1500;class C{constructor(t){d(this,"points",[]);d(this,"id",-1);d(this,"color");d(this,"segment_end_index",-1);d(this,"segment_threshold",.1);this.id=t.identifier,this.points.push({x:t.pageX,y:t.pageY,timestamp:Date.now(),alpha:1}),this.color=L(t)}update_from_touch(t){this.points.push({x:t.pageX,y:t.pageY,timestamp:Date.now(),alpha:1})}fade_old_points(){const t=Date.now(),n=t-g;var i=0,e=-1;this.points.forEach((s,r)=>{s.timestamp<=n?(s.alpha=0,i=r+1):(s.alpha=1-(t-s.timestamp)/g,e==-1&&s.alpha>this.segment_threshold&&(e=r))}),i>0&&this.points.splice(0,i),this.segment_end_index=e-i}draw(t){if(this.fade_old_points(),this.points.length<2)return;t.lineWidth=4,t.beginPath();const{x:n,y:i}=this.points[0];t.moveTo(n,i);for(var e=1;e<this.points.length-2;e++){const s=(this.points[e].x+this.points[e+1].x)/2,r=(this.points[e].y+this.points[e+1].y)/2;t.quadraticCurveTo(this.points[e].x,this.points[e].y,s,r),e==this.segment_end_index&&(t.strokeStyle=p(t,n,i,s,r,this.color,0,1),t.stroke(),t.beginPath(),t.moveTo(s,r))}t.quadraticCurveTo(this.points[this.points.length-2].x,this.points[this.points.length-2].y,this.points[this.points.length-1].x,this.points[this.points.length-1].y),this.segment_end_index<=-1||this.segment_end_index>=this.points.length-2?t.strokeStyle=p(t,n,i,this.points[this.points.length-1].x,this.points[this.points.length-1].y,this.color,0,this.points[this.points.length-1].alpha):t.strokeStyle=this.color,t.stroke(),this.id>=0&&(t.beginPath(),t.arc(this.points[this.points.length-1].x,this.points[this.points.length-1].y,20,0,2*Math.PI),t.stroke())}reset(){this.points.length=0}}window.onload=window.onresize=function(){const o=document.getElementById("canvas");o.width=window.innerWidth,o.height=window.innerHeight};let c;const a=[];let m="screen";function _(){var o=location.port=="5173"?"8080":location.port;c=new WebSocket(`ws://${location.hostname}:${o}`),c.onopen=function(){c.send(JSON.stringify({webview:{socket:"on"}}))},c.onmessage=function(t){h(`Message: ${t.data}`)},c.onclose=function(t){h(`Socket closed, reason: ${t.reason}. Reconnect in 1 second.`),setTimeout(function(){_()},1e3)},c.onerror=function(t){console.error("Socket encountered error: ",t,"Closing socket"),c.close()}}function l(o,t,n=0,i=0){let e={volume:i,velocity:n*.5+.5,density:.5+.5*n};o==2?e.play="off":o==0&&(e.play="on");let s={[m]:{grains:{[`grain_${t}`]:e}}};c==null||c.send(JSON.stringify(s))}function P(){const o=document.getElementById("canvas");o.addEventListener("touchstart",b),o.addEventListener("touchend",T),o.addEventListener("touchcancel",x),o.addEventListener("touchmove",O);const t=new URLSearchParams(location.search);for(const[n,i]of t.entries())n==="screen"&&(m=`screen_${i}`);_(),requestAnimationFrame(y),h("initialized...")}function y(){const o=document.getElementById("canvas"),t=o.getContext("2d");if(!t){h("ERROR: Could not Create Context");return}t.clearRect(0,0,o.width,o.height);let n=-1;a.forEach((i,e)=>{i.draw(t),i.id==-1&&i.points.length==0&&(n=e)}),n!=-1&&a.splice(n,1),requestAnimationFrame(y)}function f(o){var t;for(let n=0;n<a.length;n++)if(((t=a[n])==null?void 0:t.id)===o)return n;return-1}function b(o){o.preventDefault();const t=o.changedTouches;for(let n=0;n<t.length;n++){const i=t[n];if(!i)continue;h(`touchstart: ${i.identifier}`);const e=new C(i);a.push(e),l(0,a.length-1,i.pageX/this.width,1-i.pageY/this.height)}}function O(o){o.preventDefault();const t=o.changedTouches;for(let n=0;n<t.length;n++){const i=t[n];if(!i)continue;const e=f(i.identifier);if(e===-1){h(`could not continue touch ${i.identifier}`);continue}const s=a[e];s==null||s.update_from_touch(i),l(1,e,i.pageX/this.width,1-i.pageY/this.height)}}function T(o){o.preventDefault();const t=o.changedTouches;for(let n=0;n<t.length;n++){const i=t[n];if(!i)continue;const e=f(i.identifier);if(e===-1){h(`could not end touch ${i.identifier}`);continue}const s=a[e];s.id=-1,l(2,e)}}function x(o){o.preventDefault();const t=o.changedTouches;for(let n=0;n<t.length;n++){const i=t[n];if(!i)continue;const e=f(i.identifier);if(e===-1){h(`could not cancel touch ${i.identifier}`);continue}const s=a[e];s.id=-1,l(2,e)}}document.addEventListener("DOMContentLoaded",P);
