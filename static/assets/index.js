var P=Object.defineProperty;var O=(n,t,e)=>t in n?P(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>O(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();function d(n){var e;const t=document.getElementById("log");t.textContent=`${n} 
${(e=t.textContent)==null?void 0:e.slice(0,5e3)}`}function B(n){let t=n%16,e=Math.floor(n+5)%16,s=Math.floor(n+10)%16;return`#${t.toString(16)}${t.toString(16)}${e.toString(16)}${e.toString(16)}${s.toString(16)}${s.toString(16)}`}function g(n,t,e,s,o,i,r,T){const f=n.createLinearGradient(t,e,s,o);if(i.length!=7)return i;const b=i+Math.floor(r*255).toString(16).padStart(2,"0");f.addColorStop(0,b);const C=i+Math.floor(T*255).toString(16).padStart(2,"0");return f.addColorStop(1,C),f}const _=1500;class D{constructor(t,e,s,o=0){c(this,"points",[]);c(this,"id",-1);c(this,"color");c(this,"finger_index");c(this,"segment_end_index",-1);c(this,"segment_threshold",.1);this.id=s,this.points.push({x:t,y:e,timestamp:Date.now(),alpha:1}),this.color=B(o),this.finger_index=o}add_new_point(t,e){this.points.push({x:t,y:e,timestamp:Date.now(),alpha:1})}fade_old_points(){const t=Date.now(),e=t-_;var s=0,o=-1;this.points.forEach((i,r)=>{i.timestamp<=e?(i.alpha=0,s=r+1):(i.alpha=1-(t-i.timestamp)/_,o==-1&&i.alpha>this.segment_threshold&&(o=r))}),s>0&&this.points.splice(0,s),this.segment_end_index=o-s}draw(t){if(this.fade_old_points(),this.points.length<2)return;t.lineWidth=4,t.beginPath();const{x:e,y:s}=this.points[0];t.moveTo(e,s);for(var o=1;o<this.points.length-2;o++){const i=(this.points[o].x+this.points[o+1].x)/2,r=(this.points[o].y+this.points[o+1].y)/2;t.quadraticCurveTo(this.points[o].x,this.points[o].y,i,r),o==this.segment_end_index&&(t.strokeStyle=g(t,e,s,i,r,this.color,0,1),t.stroke(),t.beginPath(),t.moveTo(i,r))}t.quadraticCurveTo(this.points[this.points.length-2].x,this.points[this.points.length-2].y,this.points[this.points.length-1].x,this.points[this.points.length-1].y),this.segment_end_index<=-1||this.segment_end_index>=this.points.length-2?t.strokeStyle=g(t,e,s,this.points[this.points.length-1].x,this.points[this.points.length-1].y,this.color,0,this.points[this.points.length-1].alpha):t.strokeStyle=this.color,t.stroke(),this.id>=0&&(t.beginPath(),t.arc(this.points[this.points.length-1].x,this.points[this.points.length-1].y,20,0,2*Math.PI),t.stroke())}reset(){this.points.length=0}}function I(n){for(var t=n.reduce(function(s,o){return o.id!=-1&&(s[o.finger_index]=!0),s},{}),e=0;t[e];e++);return e}window.onload=window.onresize=function(){const n=document.getElementById("canvas"),t=document.getElementById("app");n.width=t.clientWidth,n.height=t.clientHeight};let a;const h=[],m={screen_0:{x_offset:200,y_offset:50,width:1e3,height:500},screen_1:{x_offset:100,y_offset:300,width:700,height:800}};let l="screen";function w(){var n=location.port=="5173"?"8080":location.port;a=new WebSocket(`ws://${location.hostname}:${n}`),a.onopen=function(){a.send(JSON.stringify({webview:{socket:"on"}}))},a.onmessage=function(t){d(`Message: ${t.data}`)},a.onclose=function(t){d(`Socket closed, reason: ${t.reason}. Reconnect in 1 second.`),setTimeout(function(){w()},1e3)},a.onerror=function(t){console.error("Socket encountered error: ",t,"Closing socket"),a.close()}}function u(n,t,e=0,s=0){let o={volume:s,velocity:e*.5+.5,density:.5+.5*e};n==2?o.play="off":n==0&&(o.play="on");let i={[l]:{grains:{[`grain_${t}`]:o}}};a==null||a.send(JSON.stringify(i))}function M(){const n=document.getElementById("canvas");n.addEventListener("touchstart",q),n.addEventListener("touchend",v),n.addEventListener("touchcancel",v),n.addEventListener("touchmove",F),n.addEventListener("mousedown",k),n.addEventListener("mousemove",R),n.addEventListener("mouseup",y),n.addEventListener("mouseout",y);const t=new URLSearchParams(location.search);for(const[e,s]of t.entries())e==="screen"&&(l=`screen_${s}`);if(m[l]){const e=document.getElementById("app"),s=m[l];e.style.marginLeft=`${s.x_offset}px`,e.style.marginTop=`${s.y_offset}px`,e.style.width=`${s.width}px`,e.style.height=`${s.height}px`}else{const e=document.getElementById("app");e.style.width="100%",e.style.height="100%"}w(),requestAnimationFrame(L),d("initialized...")}function L(){const n=document.getElementById("canvas"),t=n.getContext("2d");if(!t){d("ERROR: Could not Create Context");return}t.clearRect(0,0,n.width,n.height);let e=-1;h.forEach((s,o)=>{s.draw(t),s.id==-1&&s.points.length==0&&(e=o)}),e!=-1&&h.splice(e,1),requestAnimationFrame(L)}function S(n){var t;for(let e=0;e<h.length;e++)if(((t=h[e])==null?void 0:t.id)===n)return e;return-1}function E(n,t,e,s,o){const i=new D(n,t,e,I(h));h.push(i),u(0,i.finger_index,n/s,1-t/o)}function $(n,t,e,s,o){const i=S(e);if(i===-1){d(`could not continue touch ${e}`);return}const r=h[i];r.add_new_point(n,t),u(1,r.finger_index,n/s,1-t/o)}function x(n){const t=S(n);if(t===-1){d(`could not end touch ${n}`);return}const e=h[t];e.id=-1,u(2,e.finger_index)}let p=1e4;function k(n){n.preventDefault();var t=n.pageX-this.offsetLeft,e=n.pageY-this.offsetTop;E(t,e,p,this.width,this.height)}function R(n){if(n.preventDefault(),!!(n.buttons&1)){var t=n.pageX-this.offsetLeft,e=n.pageY-this.offsetTop;$(t,e,p,this.width,this.height)}}function y(n){n.buttons&1&&x(p)}function q(n){n.preventDefault();const t=n.changedTouches;for(let o=0;o<t.length;o++){const i=t[o];if(i){var e=i.pageX-this.offsetLeft,s=i.pageY-this.offsetTop;E(e,s,i.identifier,this.width,this.height)}}}function F(n){n.preventDefault();const t=n.changedTouches;for(let o=0;o<t.length;o++){const i=t[o];if(i){var e=i.pageX-this.offsetLeft,s=i.pageY-this.offsetTop;$(e,s,i.identifier,this.width,this.height)}}}function v(n){n.preventDefault();const t=n.changedTouches;for(let e=0;e<t.length;e++){const s=t[e];s&&x(s.identifier)}}document.addEventListener("DOMContentLoaded",M);
